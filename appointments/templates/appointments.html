{% extends "layout.html" %}
{% load static check_role check_status %}

{% block calendar_extras %}

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
      integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
      crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
      integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
      crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
        integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>

<link href="{% static 'calender_assets/fullcalendar.min.css' %}" rel='stylesheet'/>
<link href="{% static 'calender_assets/fullcalendar.print.min.css' %}" rel='stylesheet' media='print'/>
<script src="{% static 'calender_assets/moment.min.js' %}"></script>
<script src="{% static 'calender_assets/jquery.min.js' %}"></script>
<script src="{% static 'calender_assets/fullcalendar.min.js' %}"></script>

<script>

  $(document).ready(function() {
    var eve = [];
    var ajax_obj = function (pending_schedules, approved_schedules){
        $.ajax({
            url: '',
            data: {
                q: 'get ppointments plz',
                pending_schedules: pending_schedules,
                approved_schedules: approved_schedules,

            },
            success: function(response) {
                /*$.each(response.appointments, function(index, value) {
                  eve.push({
                        id: $(value).attr('id'),
                        title: $(value).attr('title'),
                        start: $(value).attr('start'),
                        end: $(value).attr('end'),
                        url: $(value).attr('url'),
                        color: $(value).attr('color'),
                        textColor: 'white'
                  });
                });*/
                eve = response.appointments;
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                console.info('textStatus :- ', textStatus);
                console.info('errorThrown :- ', errorThrown);
            }
        });
    };
    ajax_obj();
    console.info(eve);
    $("#pending_schedules").click(function (self, pending_schedules=true, approved_schedules=false){
        eve = [];
        ajax_obj(pending_schedules,approved_schedules);
        console.info('pending_schedules', eve);
    });
    $("#approved_schedules").click(function (self, pending_schedules=false, approved_schedules=true){
        eve = [];
        ajax_obj(pending_schedules,approved_schedules);
        console.info('approved_schedules', eve);
    });

    $('#calendar').fullCalendar({
      header: {
        left: 'prev,next today',
        center: 'title',
        right: 'month,agendaWeek,agendaDay'
      },
      defaultDate: '2020-06-01',
      navLinks: true,
      selectable: true,
      selectHelper: true,
      select: function(start, end) {
        var title = prompt('Event Title:');
        var eventData;
        if (title) {
          eventData = {
            title: title,
            start: start,
            end: end
          };
          $('#calendar').fullCalendar('renderEvent', eventData, true); // stick? = true
        }
        $('#calendar').fullCalendar('unselect');
      },
      editable: false,
      eventLimit: true, // allow "more" link when too many events
       events: function(start, end, timezone, callback) {
        $.ajax({
            url: '',
            data: {
                q: 'get ppointments plz',
            },
            success: function(response) {
                var events = [];
                $.each(response.appointments, function(index, value) {
                  events.push({
                        id: $(value).attr('id'),
                        title: $(value).attr('title'),
                        start: $(value).attr('start'),
                        end: $(value).attr('end'),
                        url: $(value).attr('url'),
                        color: $(value).attr('color'),
                        textColor: 'white'
                  });
                });
                callback(events);
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {

            }
        });
      }
    });
  });


</script>

<style>

  body {
    padding: 0;
    font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
    font-size: 14px;
  }

  #calendar {
    max-width: auto;
    margin: 0 auto;
  }
  .uk-navbar-item, .uk-navbar-nav>li>a, .uk-navbar-toggle{font-size:14px}


</style>
{% endblock calendar_extras %}

{% block content %}

{% is_localite user_role=request.session.user_role as localite_checked %}
{% is_client user_role=request.session.user_role as client_checked %}


{% if localite_checked %}
<div class="container">
    <div class="row">
    <div class="col-1">
    </div>
    <div class="col-10">
        <div class="req_appontment_form">
        <div class="alert alert-danger my-3" id="alert" role="alert" hidden>
        </div>
        <div id='calendar'></div>
        </div>
    </div>
    <div class="col-1">
    </div>
    </div>
</div>
{% endif %}
<div class="container">
    <div class="row">
        <div class="col-12">
            <h1 class="amit-black bolder montserrat page_main_header">Bookings </h1>


            <div class="profile_listing_outer mt-3">
                <div class="row">
                    <div class="col-12">
                        {% if bookings %}
                        {% for booking in bookings %}
                        <div class="profile_main_outer">
                            <div class="user_img_details_sec">
                                <div class="user_profile_rating">
                                    <div class="profile_im">
                                        {% if localite_checked  %}
                                        {% if booking.requestor.profile_image %}
                                        <img src="{{ booking.requestor.profile_image.url }}">
                                        {% else %}
                                        <img src="{{ avtar}}">
                                        {%endif %}

                                        {% else %}
                                        {% if booking.requestee.profile_image %}
                                        <img src="{{booking.requestee.profile_image.url}}">
                                        {% else %}
                                        <img src="{{ avtar}}">
                                        {% endif %}
                                        {% endif %}
                                    </div>
                                    <div class="name_rate">
                                        {% if localite_checked  %}
                                        <h5>{{ booking.requestor.username|title}}</h5>
                                        {% else %}
                                        <h5>{{ booking.requestee.username|title}} </h5>
                                        {% endif %}
                                        <p>

                                        </p>
                                    </div>
                                </div>
                                <div class="price_hire">
                                    <h5>Request on<span>{{ booking.requested_date_1 }}</span></h5>
                                </div>
                            </div>
                            <div class="right_details_sec">
                                <ul class="about_user_pro">
                                    <li>
                                        <span>Preferred Language:</span>{% for laguage in booking.requestor.language.all %} {{laguage}}, {%endfor%}
                                    </li>
                                    <li>
                                        <span>Status:</span>{{booking.get_status_display}}
                                    </li>
<!--                                    <li><span>Message:</span>Lorem Ipsum is simply dummy text of the printing and-->
<!--                                        typesetting-->
<!--                                        industry.-->
<!--                                    </li>-->
                                 {% if localite_checked  %}
                                    {% if booking.status|is_confirmed %}
                                    <li class="li_flex">
                                        <a href="#"> <button class="btn theme_btn" type="button">Edit</button></a>
                                        <span>OR</span>
                                        <a href="" class="cancel">Cancel</a>
                                    </li>
                                    {% elif booking.status|is_created %}
                                    <li class="li_flex">
                                        <a href="{% url 'new_appointment' booking.id %}"> <button class="btn theme_btn" type="button">Confirm</button></a>
                                        <span>OR</span>
                                        <a href="" class="cancel">Cancel</a>
                                    </li>

                                    {% endif %}
                                    {% elif client_checked %}
                                    {% if booking.status|is_created %}
                                    <li class="li_flex">
                                        <a href=""> <button class="btn theme_btn" type="button">Edit</button></a>
                                        <span>OR</span>
                                        <a href="" class="cancel">Cancel</a>
                                    </li>

                                    {% endif %}
                                    {% endif %}

                                </ul>
                                <div class="calander_div">
                                    <div class="stacked-icons">
                                                          <span class="fa-stack fa-3x">
                                                            <i class="fa fa-calendar-o fa-stack-2x"></i>
                                                            <strong class="fa-stack-1x calendar-text">{{ booking.requested_date_1.day }}  </strong>
                                                          </span>
                                                </div>
                                </div>
                            </div>
                        </div>
                        {% endfor%}
                        {% else %}
                        <h3>No Booking Found </h3>
                        {% endif %}


                    </div>
                </div>
                <div class="row ">
                    <div class="col-12 text-right">
                        <nav aria-label="Page navigation " class="pagination_section">
                            <ul class="pagination">
                                <li class="page-item">
                                    <a class="page-link" href="#" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                        <span class="sr-only">Previous</span>
                                    </a>
                                </li>
                                <li class="page-item"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                        <span class="sr-only">Next</span>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock content %}
