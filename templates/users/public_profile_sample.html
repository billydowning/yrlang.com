{% extends "layout.html" %}
{% load static check_role %}
{% load rating_check %}
{% load static %}
{% load leaflet_tags %}
{% load ratings  %}

{% block link_css %}
{% static 'webflow_CSS_JS_IMG' as webflow_url %}
<link href="{{webflow_url}}/css/normalize.css" rel="stylesheet" type="text/css">
<link href="{{webflow_url}}/css/webflow.css" rel="stylesheet" type="text/css">
<link href="{{webflow_url}}/css/yrlang.webflow.css" rel="stylesheet" type="text/css">
<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
<script type="text/javascript">
    WebFont.load({  google: {    families: ["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic","Varela Round:400","Lato:100,100italic,300,300italic,400,400italic,700,700italic,900,900italic","Questrial:regular"]  }});
</script>
<script type="text/javascript">
    !function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);
</script>
<link href="{{webflow_url}}/images/favicon.png" rel="shortcut icon" type="image/x-icon">
<link href="{{webflow_url}}/images/webclip.png" rel="apple-touch-icon">


{% leaflet_css %}
{% leaflet_js %}
{% endblock link_css %}


{% block content %}
{% static 'webflow_CSS_JS_IMG' as webflow_url %}
{% localite user=user as loc %}
{% provider user=user as pro %}
<div class="content-section container mt-5">
    <div class="profile_d row">
        <div class="">
            <div class="">
                <div class="div-block-31"><a href="#" class="provider-page-link">About</a>
                        <a href="#" class="provider-page-link">Reviews</a></div>
                <div class="div-block-32"></div>
                <div class="div-block-34">
                    {% if user.profile_image %}
                        <img src="{{ user.profile_image.url }}" alt="User Imgae" class="image-35">
                    {% else %}
                        <img src="{% static 'images/avtar1.png' %}" alt="image not found" class="image-35">
                    {% endif %}
                    <h3 class="heading-17">{{ user.email }} </h3>
                    <div class="job"></div>
                    <div class="star profile">
                    {% ratings user %}
                        </div>
                    <div class="text-block-21">{{reviews_total}}  reviews</div>
                    <h4 class="heading-19">About me: </h4>
                    <p class="paragraph-12">{{ user.bio|default:'No About Found' }}</p>
                    <div class="reservation-div-2">
                        <h3 class="heading-25">â‚¬100/session</h3>
                        <div class="text-block-28">estimated cost</div>
                        <div class="div-block-38"></div>
                        <div class="">Location:
                             {% if user.last_location %}
                        <div class="div-block-39">
                          {% leaflet_map "main" callback="map_init" %}
                        </div>
                      {% endif  %}
                        </div>

                        {% if pro and request.user.is_authenticated %}
                        <a data-w-id="a7d75a6a-8b70-6f10-0052-21285f1708f2" href="{% url 'create_provider_appointments' user.id %}" class="res-button w-button">Book an
                            Appointment</a>
                        {% endif %}
                         {% if loc and request.user.is_authenticated %}
                      <a data-w-id="a7d75a6a-8b70-6f10-0052-21285f1708f2" href="{% url 'request_appointment' user.id %}" class="res-button w-button">Book Visit</a>
                        {% endif %}
                    </div>
                    <div class="w-layout-grid grid">
                         <div>
                            <h3 class="overview-heading">Persolan Info:</h3>
                            <ul role="list" class="w-list-unstyled">
                                <li class="overview-item">
                                    <div class="overview-points">City : {{ user.state }}, {{ user.country }}</div>
                                </li>
                                <li class="overview-item">
                                    <div class="overview-points">Name : {% firstof user.first_name "No name" %} {{ user.last_name }}</div>
                                </li>
                                <li class="overview-item">
                                    <div class="overview-points">Email: {{ user.email }}</div>
                                </li>
                                <li class="overview-item">
                                    <div class="overview-points">Phone: {{ user.phone_number }}</div>
                                </li>

                            </ul>
                        </div>
                        <div class="div-block-40">
                            <h3 class="overview-heading">Overview</h3>
                            <ul role="list" class="list-2 w-list-unstyled">
                                <li class="overview-item"><img src="{{webflow_url}}/images/icons8-tick-box-24.png" alt="">
                                    <div class="overview-points">Hired 112 times on YrLang</div>
                                </li>
                                <li class="overview-item"><img src="{{webflow_url}}/images/icons8-tick-box-24.png" alt="">
                                    <div class="overview-points">Language proficiency verified</div>
                                </li>
                                <li class="overview-item"><img src="{{webflow_url}}/images/icons8-tick-box-24.png" alt=""
                                                               class="image-44">
                                    <div class="overview-points">Government issued ID verified</div>
                                </li>
                                <li class="overview-item"><img src="{{webflow_url}}/images/icons8-tick-box-24.png" alt="">
                                    <div class="overview-points">Background checked</div>
                                </li>
                                <li class="overview-item"><img src="{{webflow_url}}/images/icons8-tick-box-24.png" alt=""
                                                               class="image-45">
                                    <div class="overview-points">Practitioner license verified</div>
                                </li>
                                <li class="overview-item"><img src="{{webflow_url}}/images/icons8-tick-box-24.png" alt="">
                                    <div class="overview-points">20 years in business</div>
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="overview-heading">Business hours</h3>
                            <ul role="list" class="w-list-unstyled">
                                <li class="overview-item"><img src="{{webflow_url}}/images/icons8-tick-box-24.png" alt="">
                                    <div class="overview-points">Sun: closed</div>
                                </li>
                                <li class="overview-item"><img src="{{webflow_url}}/images/icons8-tick-box-24.png" alt="">
                                    <div class="overview-points">Mon - Fri: 9a - 6p</div>
                                </li>
                                <li class="overview-item"><img src="{{webflow_url}}/images/icons8-tick-box-24.png" alt="">
                                    <div class="overview-points">Sat: 10a - 3p</div>
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="overview-heading">Languages</h3>
                            <ul role="list" class="w-list-unstyled">
                                {% for lang in user.language.all %}
                                <li class="overview-item"><img src="{{webflow_url}}/images/icons8-tick-box-24.png" alt="">
                                    <div class="overview-points">{{lang}}</div>
                                </li>
                                {% endfor %}

                            </ul>
                        </div>
                        <div class="div-block-33">
                            <h3 class="overview-heading">Payment methods</h3>
                            <ul role="list" class="w-list-unstyled">

                                <li class="overview-item"><img src="{{webflow_url}}/images/icons8-tick-box-24.png" alt="">
                                    <div class="overview-points">Cash</div>
                                </li>

                                <li class="overview-item"><img src="{{webflow_url}}/images/icons8-tick-box-24.png" alt="">
                                    <div class="overview-points">Credit/Debit</div>
                                </li>

                            </ul>
                        </div>
                         {% if loc %}
                        <div class="div-block-33">
                            <h3 class="overview-heading">Profession</h3>
                            <ul role="list" class="w-list-unstyled">
                                        {% for obj in user.profession.all %}
                                <li class="overview-item"><img src="{{webflow_url}}/images/icons8-tick-box-24.png" alt="">
                                    <div class="overview-points">{{ obj }}</div>
                                </li>
                                {% empty %}
                                        No data
                                        {% endfor %}

                            </ul>
                        </div>
                        {% endif %}
                         {% if pro %}
                        <div class="div-block-33">
                            <h3 class="overview-heading">Services</h3>
                            <ul role="list" class="w-list-unstyled">
                                {% for obj in user.providercategories_set.all %}
                                <li class="overview-item"><img src="{{webflow_url}}/images/icons8-tick-box-24.png" alt="">
                                    <div class="overview-points">{{ obj.category }}</div>
                                </li>
                                {% empty %}
                                No data
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    <div><a href="{% url 'contact' user.id %}" class="profile-button w-button">Send a message</a><img
                            src="{{webflow_url}}/images/icons8-chat-100.png" alt="" class="image-36">
                        <a data-toggle="modal" data-target="#exampleModalLong" class="profile-button third w-button">Request
                        a call</a><img src="{{webflow_url}}/images/icons8-phone-50.png" alt="" class="image-38"></div>
                </div>
            </div>
        </div>

        <div class="w-container">
            <div >
                <h3 class="heading-22">Reviews</h3>
                <div class="text-block-23">This service pro is highly rated for response time, friendliness, and
                    punctuality.
                </div>
                <div class="review-star">
                    {% ratings user %}
                </div>
                <div class="text-block-24">{{reviews_total}} reviews</div>


                <div class="line-seperator"></div>
                 {% for review in reviews %}
                    {% with review.content_object|classname as object_type %}
                <div class="review-div">
                    <h4 class="heading-24">{{review.reviewer}} for {% if object_type == 'Appointment' %} Booking{% else %} {{ object_type }} {% endif %}</h4>
                    <div class="small-review-star">
                        {% with rate_temp='rating_star/widget.html' %}
                            {% ratings review.reviewer read_only=True template_name=rate_temp  %}
                        {% endwith %}
                        </div>
                    <p class="paragraph-14">{{ review.description }}</p>
                    <p class="reviews_ch">
                        <small>{{review.review_choice_1 }}</small><br>
                            <small>{{review.review_choice_2 }}</small><br>
                            <small>{{review.review_choice_3 }}</small>
                    </p>
                    <div class="text-block-27">{{ review.date_posted }}</div>


                        <div class="line-seperator">


                    </div>
                </div>
                  {% endwith %}
                        {% empty %}
                        <p> No one given rating yet !</p>
                {% endfor %}
                {% if reviews  %}
                <a href="{% url 'user_review_list' user.id  %}" class="button-2 w-button">See more reviews</a>
                      <div class="line-seperator"></div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Request for call</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
          <form method="post" action="{% url 'request_for_call' user.id %}">
              {% csrf_token %}
            {{form.as_p}}
              <input type="submit" value="send" class="btn btn-theme">
              </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>

<script type="text/javascript">
{% if user.last_location %}
    function map_init(map, options) {
        // get point lat and lon
        var lon = "{{ user.last_location.x }}";
        var lat = "{{ user.last_location.y }}";

        // zoom to point & add it to map
        map.setView([lat, lon], 12);
        L.marker([lat, lon]).addTo(map);
    }
    {% endif %}

</script>

    <script src="{{webflow_url}}/js/webflow.js" type="text/javascript"></script>


{% endblock %}